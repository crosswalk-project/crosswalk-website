<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=utf-8">
  <link rel="stylesheet" type="text/css" href="/wiki/css/gollum.css" media="all">
  <link rel="stylesheet" type="text/css" href="/wiki/css/editor.css" media="all">
  <link rel="stylesheet" type="text/css" href="/wiki/css/dialog.css" media="all">
  <link rel="stylesheet" type="text/css" href="/wiki/css/template.css" media="all">
  

  <!--[if IE 7]>
  <link rel="stylesheet" type="text/css" href="/wiki/css/ie7.css" media="all">
  <![endif]-->

  <script>
      var baseUrl = '/wiki';
      var pageFullPath = 'Overview-of-Chrome-Extension-API-Infrastructure';
  </script>
  <script type="text/javascript" src="/wiki/javascript/jquery-1.7.2.min.js"></script>
  <script type="text/javascript" src="/wiki/javascript/mousetrap.min.js"></script>
  <script type="text/javascript" src="/wiki/javascript/gollum.js"></script>
  <script type="text/javascript" src="/wiki/javascript/gollum.dialog.js"></script>
  <script type="text/javascript" src="/wiki/javascript/gollum.placeholder.js"></script>
  <script type="text/javascript" src="/wiki/javascript/editor/gollum.editor.js"></script>

  

  <title>Overview of Chrome Extension API Infrastructure</title>
</head>
<body>

<script>
Mousetrap.bind(['e'], function( e ) {
  e.preventDefault();
  window.location = "/edit" + window.location.pathname;
  return false;
});
</script>
<div id="wiki-wrapper" class="page">
<div id="head">
  <h1>Overview of Chrome Extension API Infrastructure</h1>
  <ul class="actions">
    <li class="minibutton">
      <div id="searchbar">
        <form action="/wiki/search" method="get" id="search-form">
        <div id="searchbar-fauxtext">
          <input type="text" name="q" id="search-query" value="Search&hellip;" autocomplete="off">
          <a href="#" id="search-submit" title="Search this wiki">
            <span>Search</span>
          </a>
        </div>
        </form>
      </div>    </li>
    <li class="minibutton"><a href="/wiki/"
       class="action-home-page">Home</a></li>
    <li class="minibutton"><a href="/wiki/pages"
      class="action-all-pages">All</a></li>
    <li class="minibutton"><a href="/wiki/fileview"
    class="action-fileview">Files</a></li>
    <li class="minibutton jaws">
      <a href="#" id="minibutton-new-page">New</a></li>
    <li class="minibutton jaws">
      <a href="#" id="minibutton-rename-page">Rename</a></li>
    <li class="minibutton"><a href="/wiki/edit/Overview-of-Chrome-Extension-API-Infrastructure"
       class="action-edit-page">Edit</a></li>
    <li class="minibutton"><a href="/wiki/history/Overview-of-Chrome-Extension-API-Infrastructure"
       class="action-page-history">History</a></li>
  </ul>
</div>
<div id="wiki-content">
<div class="">
  <div id="wiki-body" class="gollum-markdown-content">
    <div class="markdown-body">
      <p>The Chrome extension API is based on a different mechanism from Blink/WebKit API. It's implemented on Chromium level rather than WebKit. The mechanism consists of permission checking, API definition, API binding and API handling. This page give an overview of main modules for API binding and handling.</p>

<h3>Main modules<a class="anchor" id="Main-modules" href="#Main-modules"></a></h3>

<p>The UML diagram illustrates the main classes that are referred to Chrome Extension API implementation.</p>

<p><img src="https://raw.github.com/crosswalk-project/crosswalk/master/wiki/images/chrome_extension_api_infrastructure.png?login=cmarcelo&amp;token=204b8e4407efaf01d4efc5c14ff859e8" alt="Chrome extension API Infrastructure" /></p>

<ul><li><p>ChromeContentRendererClient.</p>

<p>When render thread in renderer process is started. The member function DidCreateScriptContext() will be called to load all required APIs.</p></li>
<li><p>Dispatcher.</p>

<p>Load defined APIs and expose them to the V8 context; Dispatches extension control messages sent to the renderer and stores renderer extension related state.</p></li>
<li><p>ModuleSystem.</p>

<p>A module system for JS similar to node.js' require() function. Each module has three variables in the global scope:
** exports, an object returned to dependencies who require() this module.
** require, a function that takes a module name as an argument and returns that module's exports object.
** requireNative, a function that takes the name of a registered NativeHandler and returns an object that contains the functions the NativeHandler defines.
Each module in a ModuleSystem is executed at most once and its exports object cached.</p></li>
<li><p>ObjectBackedNativeHandler.</p>

<p>An ObjectBackedNativeHandler is a factory for JS objects with functions on them that map to native C++ functions. Subclasses should call RouteFunction() in their constructor to define functions on the created JS objects.</p></li>
<li><p>RequestSender.</p>

<p>Responsible for sending requests for named extension API functions to the extension host and routing the responses back to the caller.</p></li>
<li><p>ExtensionHelper.</p>

<p>RenderView-level plumbing for extension features. It handles reponsed IPC from browser process.</p></li>
<li><p>ExtensionHost.</p>

<p>This class is the browser component of an extension component's RenderView. It handles setting up the renderer process, if needed, with special privileges available to extensions. It may have a view to be shown in the browser UI, or it may be hidden. The IPC message ExtensionHostMsg_Request is handled in this class.</p></li>
<li><p>ExtensionHostMsg_Request.</p>

<p>IPC message of extension API invoking. It wrappers the API name and paramters.</p></li>
<li><p>ExtensionHostMsg_Request.</p>

<p>IPC message of extension API response. It wrappers invoking results.</p></li>
<li><p>ExtensionFunctionDispatcher.</p>

<p>A factory function for creating new ExtensionFunction instances. ExtensionFunctionDispatcher receives requests to execute functions from ExtensionHost and dispatches them to the appropriate handler. It lives entirely on the UI thread of browser process.</p></li>
<li><p>ExtensionFunctionRegistry.</p>

<p>It contains a list of all known extension functions and allows ExtensionFunctionDispatcher to create instances of them.</p></li>
<li><p>ExtensionFunction.</p>

<p>Abstract base class for extension functions the ExtensionFunctionDispatcher. The logic of an extension API is implemented as the member Run(). Clients should initialize the ExtensionFunction using SetArgs(), set_request_id(), and the other setters before calling Run(). Derived classes should be ready to return GetResultList() and GetError() before returning from this function.</p></li>
</ul><h3>API Binding<a class="anchor" id="API-Binding" href="#API-Binding"></a></h3>

<p>This sequence diagram below shows the main steps of API binding.</p>

<p><img src="https://raw.github.com/crosswalk-project/crosswalk/master/wiki/images/chrome_extension_api_binding.png?login=cmarcelo&amp;token=1cb554e5b6c0bea9bbc863622fef72ff" alt="Chrome extension API Binding" /></p>

<h3>API Handling<a class="anchor" id="API-Handling" href="#API-Handling"></a></h3>

<p>This sequence diagram below shows the main steps of API handling.</p>

<p><img src="https://raw.github.com/crosswalk-project/crosswalk/master/wiki/images/chrome_extension_api_handling.png?login=cmarcelo&amp;token=f78f6bb2a758c025bc18dd6dcc4a5ed2" alt="Chrome extension API Handling" /></p>
    </div>
  </div>
  </div>

</div>
<div id="footer">
  <p id="last-edit">Last edited by <b>James Ketrenos</b>, 2013-09-01 21:04:08</p>
  <p>
    <a id="delete-link" href="/wiki/Overview-of-Chrome-Extension-API-Infrastructure" data-confirm="Are you sure you want to delete this page?"><span>Delete this Page</span></a>
  </p>
</div>
</div>

<form name="rename" method="POST" action="/wiki/rename/Overview-of-Chrome-Extension-API-Infrastructure">
  <input type="hidden" name="rename"/>
  <input type="hidden" name="message"/>
</form>


</body>
</html>
