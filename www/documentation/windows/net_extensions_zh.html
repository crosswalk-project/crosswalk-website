<!DOCTYPE html>
<html id="top">
  <head>
    <meta charset="utf-8">
    <title>The Crosswalk Project</title>
    <link rel="shorcut icon" href="/assets/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon" />
    <script>
      WebFontConfig = {
        custom: {
          families: ['Clear Sans'],
          urls: ['/css/fonts.css']
        },
        google: {
          families: ['Source Code Pro:n4,n6']
        },
        timeout: 2000
      };
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script async defer src="//ajax.googleapis.com/ajax/libs/webfont/1.5.3/webfont.js"></script>
    <link rel="stylesheet" href="/css/main.css">

    <meta name="description" content="Enable the most advanced web innovations with the Crosswalk Project web runtime to develop powerful Android and Cordova apps." />
    <meta name="author" content="Crosswalk" />
    <meta name="handheldfriendly" content="true" />
    <meta name="mobileoptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="cleartype" content="on" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <!-- Facebook -->
    <meta property="og:side_name" content="Crosswalk" />
    <meta property="og:title" content=".NET Extensions" />
    <meta property="og:url" content="http://crosswalk-project.org/documentation/windows/net_extensions_zh" />
    <meta property="og:description" content="Enable the most advanced web innovations with the Crosswalk Project web runtime to develop powerful Android and Cordova apps." />
    <meta property="og:image" content="/assets/crosswalk-og-banner.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:url" content="http://crosswalk-project.org/documentation/windows/net_extensions_zh" />
    <meta name="twitter:title" content=".NET Extensions" />
    <meta name="twitter:description" content="Enable the most advanced web innovations with the Crosswalk Project web runtime to develop powerful Android and Cordova apps." />
    <meta name="twitter:site" content="@xwalk_project" />

    <!-- Relevant original Crosswalk Project JS -->
    <script src="/js/utils.js"></script>
    <script src="/js/xwalk.js"></script>
    <script src="/js/versions.js"></script>
    <script src="/js/demos.js"></script>
    <script src="/js/testimonials.js"></script>
    <script src="/js/tools.js"></script>
    <script src="/js/qualityindicators.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <!-- If curr page named 'index' and less than 2 dirs deep,
         do custom layouts. (home screen, blog, app-mgmt page)
         Else, provide doc header and nav. -->
    
    <div class="container">
      <div class="doc-header">
        


  <div class="doc-logo-div">
     <a href="/index_zh.html" class="doc-logo-link">
       <img src="/assets/identity/crosswalkproject-logo-horizontal-dark.png" class="doc-logo-img">
     </a>
  </div>
  <div class="doc-nav-div">
    <ul class="doc-nav-list">
      <li class="doc-nav-item">
        <a href="/documentation/getting_started_zh.html" class="doc-nav-link">文档</a>
      </li>
      <li class="doc-nav-item">
        <a href="/blog/index_zh.html" class="doc-nav-link">博客</a>
      </li>
      <li class="doc-nav-item hide-on-small">
        <a href="/contribute/index_zh.html" class="doc-nav-link">贡献</a>
      </li>
      <li class="doc-nav-item hide-on-small">
        <a href="https://github.com/crosswalk-project/crosswalk-website/wiki" class="doc-nav-link">维基</a>
      </li>
      <li class="doc-nav-item hide-on-small">
        <a href="/documentation/about/faq_zh.html" class="doc-nav-link">常见问题</a>
      </li>
      <li class="doc-nav-item">
	<span class="i18n-label" id="i18n-label">
	  <span id="i18n-inner">
	    <img src="/assets/i18n-globe.png" class="i18n-globe" />
	    中文版
	    <img src="/assets/i18n-arrow.png" class="i18n-arrow"/>
	  </span>
	  <div id="i18n-menu" class="i18n-menu i18n-menu-light">
            <a onclick="switchLanguage('English')">English</a>
            <a onclick="switchLanguage('Chinese')">中文版</a>
	  </div>
	</span>
      </li>
    </ul>
  </div>
  

      </div>
      <br />
      <div class="doc-main">
        <div class="row">
          
          <div id="translation-missing-toaster">
  <p style="padding:10px"> 抱歉，该网页目前还不存在中文版本，请继续浏览其他网页！ </p>
</div>

          



<nav id="contents" class="article-toc nav-toggleContainer">
  <a href="#contents" id="contents-toggle" class="button button--small button--tertiary nav-toggle">Table of Contents</a>
  <a href="./#contents-toggle" class="button button--small button--tertiary nav-toggle--dummy">Table of Contents</a>
  <ul class="article-list nav-toggleHide">
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/about_zh.html">关于</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/getting_started_zh.html">开始</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/crosswalk-app-tools_zh.html">Crosswalk App Tools</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/android_zh.html">Android</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/ios_zh.html">iOS</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/windows_zh.html">Windows</a>
        
            <ul class="article-list">
            
              <li class="article-item ">
                <a class="article-link" href="/documentation/windows/windows_host_setup_zh.html">Windows开发环境设置</a>
                
              </li>
            
              <li class="article-item ">
                <a class="article-link" href="/documentation/windows/build_an_application_zh.html">创建应用</a>
                
              </li>
            
              <li class="article-item ">
                <a class="article-link" href="/documentation/windows/run_on_windows_zh.html">在Windows环境运行</a>
                
              </li>
            
              <li class="article-item ">
                <a class="article-link" href="/documentation/windows/web_inspector_debugging_zh.html">Web Inspector调试</a>
                
              </li>
            
              <li class="article-item ">
                <a class="article-link" href="/documentation/windows/deploy_windows_store_zh.html">部署到Windows store</a>
                
              </li>
            
              <li class="article-item  nav-item--active">
                <a class="article-link" href="/documentation/windows/net_extensions_zh.html">.NET Extensions</a>
                
              </li>
            
              <li class="article-item ">
                <a class="article-link" href="/documentation/windows/build_crosswalk_for_windows_zh.html">在Windows上编译Crosswalk</a>
                
              </li>
            
              <li class="article-item ">
                <a class="article-link" href="/documentation/windows/extensions_zh.html">扩展</a>
                
              </li>
            
            </ul>
          
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/linux_zh.html">Linux</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/cordova_zh.html">Cordova</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/manifest_zh.html">Manifest</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/apis_zh.html">API</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/shared_mode_zh.html">共享模式</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/download_mode_zh.html">下载模式</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/crosswalk_lite_zh.html">Crosswalk Lite</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/samples_zh.html">样例</a>
        
        </li>
    
        <li class="article-item ">
        <a class="article-link" href="/documentation/qa_zh.html">质量保证</a>
        
        </li>
    
  </ul>

</nav>

<article class="article article--hasToC">
  <h1>.NET扩展程序</h1>
<p>Crosswalk的.NET扩展程序是使用.NET语言编写，并且可以访问标准的.NET API。它允许在你的Crosswalk应用中将这些接口暴露给JavaScript。</p>
<h2>.NET扩展程序系统</h2>
<p>Windows平台上的Crosswalk可以从指定路径加载若干个扩展，因此你可以将多个.NET接口暴露给你的Crosswalk应用。针对Windows平台的Crosswalk希望每个.NET 扩展为一个多架构的DLL文件，其中每个文件定义多个入口点，这样便可以实现Crosswalk和扩展之间的通信。.NET扩展在一个分离的过程中被加载（为了安全性和稳定性因素）。</p>
<p>当你写.NET extension时需要知道两个主要的类：</p>
<ul>
<li><code>XWalkExtension</code>只被实例化一次，并且可以被Crosswalk用来获取关于扩展本身的信息：JavaScript API和扩展名称（用于JavaScript前缀）。</li>
<li><code>XWalkExtensionInstance</code> 依据浏览器环境（例如iframes）可以被多次创建。每个实例负责处理从Crosswalk传递的信息并返回给Crosswalk。</li>
</ul>
<p>每个.NET扩展需要附带一个Crosswalk提供的bridge。仅需要复制并根据你的.NET扩展程序的 DLL名称加上后缀<code>_bridge</code>重新命名。例如，如果你的扩展被称为<code>echo_extension.dll</code>，bridge应该称为<code>echo_extension_bridge.dll</code>。</p>
<h2><a class='doc-anchor' id='Writing-your-Net-Extension_zh'></a>编写你的.NET扩展程序</h2>
<ol>
<li><p>下载并安装<a href="https://www.visualstudio.com/en-us/downloads/download-visual-studio-vs.aspx">Visual Studio 2013</a>。 （2015目前还没有测试）。</p>
</li>
<li><p>下载并安装<a href="https://visualstudiogallery.msdn.microsoft.com/51e648be-c91a-40fa-9d13-8f49ec134e86">Crosswalk .NET扩展程序Visual Studio模板</a>。也许你也可以在Visual Studio的扩展和更新对话框中检索它。</p>
<p>这个模板将会帮助你在Visual Studio中快速创建一个扩展。</p>
</li>
<li><p>打开Visual Studio并且点击：File -&gt; New Project</p>
</li>
<li><p>在新的对话框中，选择“Visual C#”并且将滚动条下拉到底部的列表，其中你可以找到Crosswalk .NET扩展程序的简单模板。</p>
<p><a href="/assets/win5-new-project.png"><img src="/assets/win5-new-project.png" style="display: block; margin: 0 auto"/></a></p>
</li>
<li><p>输入你的.NET extension的名称，设置位置并且传递一个名称给Visual Studio解决方案</p>
</li>
<li><p>点击OK后你便完成了所有的设置：</p>
<p><a href="/assets/win6-visual-studio.png"><img src="/assets/win6-visual-studio.png" style="display: block; margin: 0 auto"/></a></p>
<p>请注意默认的Windows运行时API不可用，但是你可以通过右击你的项目，然后执行Add -&gt; References，标记Windows下的Core并将其添加。</p>
</li>
</ol>
<p>在<code>XWalkExtension</code>类中有两个你应该实现的方法：</p>
<ul>
<li><code>ExtensionName()</code>: 这个是你用JavaScript编写的扩展程序的前缀，并且关于如何调用你的扩展程序提供的API。例如，你可以返回“echo”，那么你所有使用JavaScript的调用都将以“echo”为前缀。</li>
<li><p><code>ExtensionAPI()</code>: 这个是你将暴露给JavaScript的API。下图是关于一个简单的&quot;Echo&quot;应用如何使用这API的示例。</p>
<p><a href="/assets/win7-extension-config.png"><img src="/assets/win7-extension-config.png" style="display: block; margin: 0 auto"/></a></p>
</li>
</ul>
<h3>编写扩展API</h3>
<ul>
<li>任何你想作为JavaScript API暴露给扩展程序的属性（方法，对象，实例等）都应该被附加到JavaScript API文件内暴露的对象上。这和nodejs中暴露对象的职责有相似的作用，定义API的公众接口。任何其他没有附加到exports上的变量只能被限制到文件作用域内，并不会扩展web应用的全局命名空间。在这个简单的“echo”样例中，我们有两个暴露的方法：<code>echo</code>和<code>syncEcho</code>。在JavaScript方面，它们将会被以这种方式调用：<code>echo.echo(“test”)</code>和<code>echo.syncEcho(“test”)</code>。</li>
<li><code>extension</code>对象是通过.NET扩展Framework设定并包含与你的扩展程序的.Net方交流的方法：<code>extension.PostMessage()</code>和<code>extension.internal.sendSyncMessage()</code>。前者较简单，它从JavaScript向将要处理它的.NET部分发送消息。<code>sendSyncMessage</code>是相似的，但是它是同步调用（并且因此阻塞），这意味着它将在.NET部分发出response以后才会返回。</li>
<li><code>extension.setMessageListener()</code>设置一个调用函数用于.NET方面的extension返回的每条信息。在这个简单的样例中，当.NET响应我们的消息时，<code>echo()</code>函数从将要被调用的调用者处采用一个回调。在这种情况下，当.NET回复时监听者将被调用并且调用回调函数。</li>
</ul>
<h3>实现XWalkExtensionInstance类</h3>
<ul>
<li>关于构造器：你不应该修改将被加载的.NET扩展的签名。它采用一个参数<code>dynamic native</code>，该参数将被用于反馈信息给Crosswalk扩展系统。</li>
<li><code>HandleMessage(String message)</code>用于处理每条由JavaScript发起的消息，所以对上文中提及的<code>extension.PostMessage()</code>的每次调用均会发出改函数的调用。消息的参数包含从JavaScript传递下来的信息。</li>
<li><code>HandleSyncMessage(String message)</code>等同于<code>HandleMessage</code>，但是接收JavaScript 中对于<code>sendSyncMessage()</code>的调用。你应该在那个函数中设置一个对JavaScript的reply，否则javaScript执行会被阻塞。</li>
<li>对JavaScript的通信反馈是通过在本地处理中使用<code>PostMessageToJS</code>和<code>SendSyncReply</code>完成。在这个简单的样例中，<code>PostMessageToJS</code>简单的发送一个回复到JavaScript，并且被JavaScript API（它将会调用回调）消息监听器捕获。<code>SendSyncReply</code>应该在<code>HandleSyncMessage</code>内调用，并且告诉.NET 扩展框架你已经完成了你的同步调用，JavaScript的执行将被恢复。你的JavaScript调用的返回值是由<code>SendSyncReply</code>方法的参数设置。</li>
</ul>
<p>当你完成这些后，点击编译菜单并且选择&#39;Build Solution&#39;创建你的扩展程序DLL。</p>
<h3>.NET扩展中的高级JavaScript API</h3>
<p>在上文<a href="#Writing-your-Net-Extension_zh">编写你的.NET扩展程序</a>中的样例是一个JavaScript中相当简单并且普通的API。</p>
<p>你的JavaScript API中存在多个调用<code>PostMessage</code>的方法是很常见的，所以你的.NET扩展程序中的 <code>handleMessage</code>变得很棘手。一种处理这个难题的方法是，在JavaScript和.NET扩展之间传递基于JSON的消息，在消息中可以携带ID和消息内容。ID将被用于识别消息来自哪个JavaScript API，并且任何其他的属性也可以被当做参数继续传递。一旦被.NET <code>handleMessage</code>接收，便会直接反序列化接收到的JSON。以下展示了在JavaScript端代码的编写方式：</p>
<pre><code>// private method for building the message object and converting it
// to a JSON string for transfer to the .NET part of the extension
var messageToJson = function (method, message) {
  var obj = {
    id: &#39;&#39; + method,
    content: message
  };

  return JSON.stringify(obj);
};

exports.echoAsync = function (message, callback) {
  extension.PostMessage(messageToJson(“async”, message));
  ...
}

exports.echo2 = function (message, callback) { 
  extension.PostMessage(messageToJson(“echo2”, message));
  ...
}</code></pre>
<p>关于.NET方面请参见<a href="https://msdn.microsoft.com/en-us/library/bb412179(v=vs.110"><a href="https://msdn.microsoft.com/en-us/library/bb412179(v=vs.110).aspx">https://msdn.microsoft.com/en-us/library/bb412179(v=vs.110).aspx</a></a></p>
<p>你可能想要基于<a href="http://promises-aplus.github.io/promises-spec/">Promises</a>实现一个API。在前面的样例中，我们展示了一种回调机制但是必须谨慎使用：如果回调是包含在回调中的回调等，它可能导致所谓的<a href="https://github.com/survivejs/js_tricks_and_tips/blob/master/common_problems/pyramid.md">金字塔效应</a>。</p>
<h3>使用crosswalk-app-tools打包你的扩展</h3>
<p>通过你的.NET扩展打包你的.MSI安装程序的功能正在被实现。当功能被完成并且成为Crosswalk打包工具的一部分时，本小节将被更新。</p>
<h3>使用针对Windows二进制文件的Crosswalk测试你的.NET扩展。</h3>
<p>下载完针对Windows平台的Crosswalk并且解压后，你可以轻松地测试你的扩展程序。</p>
<p>如果你没有使用Visual Studio的模板，你需要做接下来的两步。开启2.0版本的模板，bridge将会被自动添加。
1.  确保在你创建.NET扩展的文件夹（.DLL位于的地方）中复制了xwalk_extension_bridge.dll文件。
2.  重命名<code>xwalk_extension_bridge.dll</code>，除了后缀<code>_bridge</code>唯一不同，其余部分和你的扩展 DLL命名完全相同。例如：</p>
<p>   <img src="/assets/win9-extension-net-bridge.png" style="display: block; margin: 0 auto"/></p>
<ol>
<li><p>在命令行内，导航到你解压Crosswalk项目的路径并且使用<a href="/documentation/windows/run_on_windows_zh.html#Run-using-Crosswalk-binary-directly_zh">直接使用Crosswalk二进制文件运行</a>中描述的方法运行它，具体参数如下：</p>
<ul>
<li><code>--allow-external-extensions-for-remote-sources</code> (这个允许对本地环境的外部扩展，你不需要担心什么时候打包Crosswalk应用工具包），</li>
<li><code>--external-extensions-path=/path/to/myextension/myextension.dll</code>.</li>
</ul>
<p>命令行应该如下：</p>
<pre><code>&gt; xwalk.exe --allow-external-extensions-for-remote-sources \
             --external-extensions-path=/path/to/myextension/myextension.dll \
             http://localhost:8000</code></pre>
</li>
</ol>
<p>你的扩展应该被加载。请注意你可以在同一个目录下添加多个扩展（和它们各自的bridge），Crosswalk将会加载它们。</p>

  <footer class="article-next">
    



  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
      
    
  
    
    
  
    
    
      
      <a href="/documentation/windows/build_crosswalk_for_windows_zh.html" class="article-promo well">
        <em>下一节关于什么？</em>
        <h3>在Windows上编译Crosswalk</h3>
      </a>
    
  
    
    
  
    
    
  


  </footer>
</article>

          
        </div>
      </div>
    </div>
    

    
 
  <hr class="footer-divider" style="margin-top:125px; margin-bottom:0px" />
    <div style="position:relative; top:-30px;">
       <a href="/"><img src="/assets/cw-logo-circle.png" width="60px" style="display:block; margin: 0 auto;" /></a>
    </div>
    <footer class="footer footer--documentation" >
      <div class="container" >
        <div class="row">
          <div  class="footer-div" language="en">
          <img src="/assets/Twitter_logo_blue.png" width="20px" /> Follow  <a href="http://twitter.com/xwalk_project">@xwalk_project on Twitter</a> for the latest developer activities and project updates.
          </div>
           <div  class="footer-div" language="zh" style="display:none">
           <img src="/assets/Sina_Weibo_Blue.png" width="60px" /> 参考<a href="http://weibo.com/crosswalk">微博</a> 最新的开发者活动或者更新。
          </div>
          <div class="footer-div">
             Latest blog post:</br>
              
              
                <b><a href="/blog">WebCL APIs removed from Crosswalk 22</a></b><br/>
                &nbsp;(<span ><time class="js-vagueTime" datetime="Tue, 30 Aug 2016 09:30:00 GMT">2016-08-30T09:30</time></span>)
              
              <br/>
           </div>
          <div class="footer-div">
              <strong><a href="/feed.xml"><img src="/assets/rss-icon-16.gif" style="vertical-align:middle" /> RSS Feed</a></strong>
          </div>
          <div class="footer-div">
             <a href="/documentation/getting_started_zh.html"> 文档</a> &nbsp;
             <a href="/blog/index_zh.html"> 博客</a> &nbsp;
             <a href="/documentation/downloads_zh.html"> 下载</a> <br />
             <a href="https://crosswalk-project.org/jira/secure/Dashboard.jspa"> 问题</a> &nbsp;
             <a href="https://github.com/crosswalk-project"> GitHub资源</a> &nbsp;
             <a href="/sitemap.html">Sitemap</a> <br/>
          </div>
        </div>
        <div class="row">
            <small>
              Crosswalk项目由Intel Open Source Technology Center开发。版权为 © 2013–2016 Intel Corporation。保留所有权利。 <a href="https://github.com/crosswalk-project/crosswalk-website/wiki/Privacy-Policy">  Privacy策略 </a>  *其他名称和商标可能被声明为他人财产
            </small>
        </div>
      </div>
    </footer>
<script>
    $("[language=en]").css("display","none");
    $("[language=zh]").css("display","block");
</script>

    
    
      <!-- Google Tag Manager -->
      <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WC843Q"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-WC843Q');</script>
      <!-- End Google Tag Manager -->
    
    <script src="/js/smoothScroll.js"></script>
    <script src="/js/vagueTime.js"></script>
    <!-- <script async defer src="/js/trmix.js"></script> -->
  </body>
</html>
